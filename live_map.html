<!DOCTYPE html>
<html>
<head>
<title>Live Location Map</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {
    font-family: Arial;
    margin: 20px;
}
#map {
    height: 500px;
    width: 100%;
}
button {
    padding: 8px 12px;
    margin-right: 10px;
}
</style>
</head>

<body>

<h2>Live Location Tracking Map</h2>

<button onclick="startLiveLocation()">Start Live Location</button>
<button onclick="stopLiveLocation()">Stop Live Location</button>

<p>Current Location: <span id="location">Not detected</span></p>

<div id="map"></div>

<script>

// Create map (default view Pune)
let map = L.map('map').setView([18.5204, 73.8567], 13);

// Add OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
}).addTo(map);

let watchId = null;
let userMarker = null;

// Start live tracking
function startLiveLocation(){

    if(navigator.geolocation){

        watchId = navigator.geolocation.watchPosition(

            function(position){

                const lat = position.coords.latitude;
                const lng = position.coords.longitude;

                document.getElementById("location").innerText =
                    lat.toFixed(6) + ", " + lng.toFixed(6);

                // If marker exists → move it
                if(userMarker){
                    userMarker.setLatLng([lat, lng]);
                } else {
                    // First time create marker
                    userMarker = L.marker([lat, lng])
                        .addTo(map)
                        .bindPopup("You are here")
                        .openPopup();
                }

                // Move map center
                map.setView([lat, lng], 15);

            },

            function(error){
                alert("Location error: " + error.message);
            },

            {
                enableHighAccuracy: true
            }

        );
    } else {
        alert("Geolocation not supported.");
    }
}

// Stop tracking
function stopLiveLocation(){
    if(watchId !== null){
        navigator.geolocation.clearWatch(watchId);
        alert("Live tracking stopped.");
    }
}

</script>

</body>
</html>